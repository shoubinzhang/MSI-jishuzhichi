# 外网访问配置指南

## 使用内网穿透时的配置修改

### 1. 修改 dist/.env.production 文件

假设你的内网穿透域名为：
- 后端：https://yourapp.natapp1.cc  
- 前端：https://yourapp2.natapp1.cc

```bash
# 域名配置（修改为你的内网穿透域名）
FRONTEND_URL=https://yourapp2.natapp1.cc
BACKEND_URL=https://yourapp.natapp1.cc

# CORS配置（允许前端域名访问）
CORS_ORIGIN=https://yourapp2.natapp1.cc
```

### 2. 修改前端配置

修改 `client/.env.production` 文件：

```bash
# API地址（修改为你的后端内网穿透域名）
VITE_API_BASE_URL=https://yourapp.natapp1.cc
```

### 3. 重新构建和启动

```bash
# 重新构建前端
cd client
npm run build

# 重启后端服务
# 停止当前服务，然后重新启动
```

## 公网服务器部署方案

### 1. 服务器要求
- Linux 服务器（推荐 Ubuntu 20.04+）
- 公网 IP 和域名
- SSL 证书（Let's Encrypt 免费）

### 2. 部署步骤

#### 步骤1：服务器环境准备
```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装 Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 安装 PM2
sudo npm install -g pm2

# 安装 Nginx
sudo apt install nginx -y
```

#### 步骤2：上传代码
```bash
# 创建应用目录
sudo mkdir -p /var/www/hospital-login-system
sudo chown $USER:$USER /var/www/hospital-login-system

# 上传代码到服务器
# 可以使用 scp、git clone 等方式
```

#### 步骤3：配置环境变量
```bash
# 修改生产环境配置
nano /var/www/hospital-login-system/dist/.env.production

# 将域名配置修改为你的实际域名
FRONTEND_URL=https://yourdomain.com
BACKEND_URL=https://yourdomain.com
CORS_ORIGIN=https://yourdomain.com
```

#### 步骤4：配置 Nginx
```nginx
server {
    listen 80;
    server_name yourdomain.com;
    
    # 前端静态文件
    location / {
        root /var/www/hospital-login-system/dist/static;
        try_files $uri $uri/ /index.html;
    }
    
    # 后端 API
    location /api/ {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

#### 步骤5：启动服务
```bash
# 进入应用目录
cd /var/www/hospital-login-system

# 安装依赖
npm install --production

# 使用 PM2 启动
pm2 start dist/index.js --name "hospital-login-system"

# 设置开机自启
pm2 startup
pm2 save
```

#### 步骤6：配置 SSL
```bash
# 安装 Certbot
sudo apt install certbot python3-certbot-nginx

# 获取 SSL 证书
sudo certbot --nginx -d yourdomain.com

# 自动续期
sudo crontab -e
# 添加：0 12 * * * /usr/bin/certbot renew --quiet
```

## 微信公众号配置

如果需要微信公众号集成，还需要：

1. **配置服务器URL**：在微信公众平台设置你的域名
2. **网页授权域名**：添加你的域名到授权列表
3. **修改微信配置**：在 .env.production 中填入真实的 AppID 和 AppSecret

## 总结

- **临时测试**：使用内网穿透（NATAPP、花生壳等）
- **正式部署**：购买云服务器 + 域名 + SSL证书
- **微信集成**：必须使用 HTTPS 和备案域名

选择哪种方案取决于你的具体需求和预算。